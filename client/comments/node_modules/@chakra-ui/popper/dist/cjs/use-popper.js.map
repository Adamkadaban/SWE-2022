{"version":3,"sources":["../../src/use-popper.ts"],"names":["isBrowser","window","useSafeLayoutEffect","React","useLayoutEffect","useEffect","usePopper","props","placement","initialPlacement","offsetProp","offset","preventOverflow","fixed","forceUpdate","flip","arrowSize","arrowShadowColor","gutter","eventsEnabled","modifiers","popper","useRef","referenceRef","popoverRef","arrowRef","useState","originalPlacement","place","setPlacement","popoverStyles","setPopoverStyles","arrowStyles","setArrowStyles","update","useCallback","current","modifiersOverride","strategy","name","enabled","options","padding","gpuAcceleration","adaptive","tetherOffset","clientWidth","Boolean","element","phase","fn","state","styles","arrow","destroy","id","requestAnimationFrame","cancelAnimationFrame","computedArrowStyles","popperInstance","reference","ref","style","transformOrigin"],"mappings":"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","sourcesContent":["import * as React from \"react\"\nimport { Instance, createPopper, Modifier } from \"@popperjs/core\"\nimport type { Placement } from \"@popperjs/core\"\nimport { getArrowStyles, toTransformOrigin } from \"./popper.utils\"\n\nconst isBrowser = typeof window !== \"undefined\"\nconst useSafeLayoutEffect = isBrowser ? React.useLayoutEffect : React.useEffect\n\nexport type { Placement }\n\nexport interface UsePopperProps {\n  gutter?: number\n  placement?: Placement\n  offset?: number\n  preventOverflow?: boolean\n  fixed?: boolean\n  forceUpdate?: boolean\n  flip?: boolean\n  arrowSize?: number\n  arrowShadowColor?: string\n  eventsEnabled?: boolean\n  modifiers?: Modifier<any, any>[]\n}\n\nexport function usePopper(props: UsePopperProps = {}) {\n  const {\n    placement: initialPlacement = \"bottom\",\n    offset: offsetProp,\n    preventOverflow = true,\n    fixed = false,\n    forceUpdate = true,\n    flip = true,\n    arrowSize = 10,\n    arrowShadowColor,\n    gutter = arrowSize,\n    eventsEnabled = true,\n    modifiers,\n  } = props\n\n  const popper = React.useRef<Instance | null>(null)\n  const referenceRef = React.useRef<HTMLButtonElement>(null)\n  const popoverRef = React.useRef<HTMLDivElement>(null)\n  const arrowRef = React.useRef<HTMLDivElement>(null)\n\n  const [originalPlacement, place] = React.useState(initialPlacement)\n  const [placement, setPlacement] = React.useState(initialPlacement)\n  const [offset] = React.useState(offsetProp || [0, gutter])\n  const [popoverStyles, setPopoverStyles] = React.useState<React.CSSProperties>(\n    {},\n  )\n  const [arrowStyles, setArrowStyles] = React.useState<React.CSSProperties>({})\n\n  const update = React.useCallback(() => {\n    if (popper.current) {\n      popper.current.forceUpdate()\n      return true\n    }\n    return false\n  }, [])\n\n  const modifiersOverride = modifiers ?? []\n\n  useSafeLayoutEffect(() => {\n    if (referenceRef.current && popoverRef.current) {\n      popper.current = createPopper(referenceRef.current, popoverRef.current, {\n        placement: originalPlacement,\n        strategy: fixed ? \"fixed\" : \"absolute\",\n        modifiers: [\n          {\n            name: \"eventListeners\",\n            enabled: eventsEnabled,\n          },\n          {\n            name: \"applyStyles\",\n            enabled: false,\n          },\n          {\n            name: \"flip\",\n            enabled: flip,\n            options: { padding: 8 },\n          },\n          {\n            name: \"computeStyles\",\n            options: { gpuAcceleration: false, adaptive: false },\n          },\n          {\n            name: \"offset\",\n            options: { offset },\n          },\n          {\n            name: \"preventOverflow\",\n            enabled: preventOverflow,\n            options: {\n              tetherOffset: () => arrowRef.current?.clientWidth || 0,\n            },\n          },\n          {\n            name: \"arrow\",\n            enabled: Boolean(arrowRef.current),\n            options: { element: arrowRef.current },\n          },\n          {\n            name: \"updateState\",\n            phase: \"write\",\n            enabled: true,\n            fn({ state }) {\n              setPlacement(state.placement)\n              setPopoverStyles(state.styles.popper as React.CSSProperties)\n              setArrowStyles(state.styles.arrow as React.CSSProperties)\n            },\n          },\n          ...modifiersOverride,\n        ],\n      })\n    }\n    return () => {\n      if (popper.current) {\n        popper.current.destroy()\n        popper.current = null\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    originalPlacement,\n    fixed,\n    forceUpdate,\n    flip,\n    offset,\n    preventOverflow,\n    eventsEnabled,\n  ])\n\n  useSafeLayoutEffect(() => {\n    const id = requestAnimationFrame(() => {\n      if (forceUpdate) {\n        popper.current?.forceUpdate()\n      }\n    })\n    return () => {\n      cancelAnimationFrame(id)\n    }\n  }, [forceUpdate])\n\n  const computedArrowStyles: React.CSSProperties = {\n    ...arrowStyles,\n    ...getArrowStyles(placement, arrowSize, arrowShadowColor),\n  }\n\n  return {\n    popperInstance: popper.current,\n    reference: {\n      ref: referenceRef,\n    },\n    popper: {\n      ref: popoverRef,\n      style: {\n        ...popoverStyles,\n        transformOrigin: toTransformOrigin(placement),\n      },\n    },\n    arrow: {\n      ref: arrowRef,\n      style: computedArrowStyles,\n    },\n    update,\n    placement,\n    place,\n  }\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"file":"use-popper.js"}